{
  "rules": {
    /* 1. ADMIN SETTINGS */
    "admin_settings": {
      ".read": "auth.token.email === 'alenacloft0@gmail.com'",
      ".write": "auth.token.email === 'alenacloft0@gmail.com'"
    },

    /* 2. USERS: Affiliate & Hacker Protection */
    "users": {
      ".read": "auth != null",
      ".indexOn": ["referralCount"],
      "$uid": {
        ".read": "auth != null && (auth.uid === $uid || auth.token.email === 'alenacloft0@gmail.com')",
        
        // HACKER PROTECTION: Users can spend (subtract) but NEVER add money.
        "balance": { 
          ".write": "auth != null && auth.uid === $uid && newData.val() < data.val() && newData.val() >= 0" 
        },
        "wallet": { 
          ".write": "auth != null && auth.uid === $uid && newData.val() < data.val() && newData.val() >= 0" 
        },
        "referralCount": { ".write": "false" },
        "referralBonus": { ".write": "false" },
        
        ".write": "auth != null && auth.uid === $uid && !data.exists()"
      }
    },

    /* 3. TRANSACTIONS */
    "transactions": {
      ".read": "auth != null && (auth.token.email === 'alenacloft0@gmail.com' || query.orderByChild === 'uid' && query.equalTo === auth.uid)",
      ".indexOn": ["uid"],
      "$txid": {
        ".write": "auth.token.email === 'alenacloft0@gmail.com'"
      }
    },

    /* 4. PENDING ORDERS: The Secure Trigger */
    "pending_orders": {
      ".read": "auth.token.email === 'alenacloft0@gmail.com'",
      "$orderid": {
        ".write": "auth != null && !data.exists() && newData.child('uid').val() === auth.uid",
        ".validate": "newData.hasChildren(['network', 'plan', 'recipient', 'amount', 'uid', 'status', 'timestamp'])"
      }
    },

    /* 5. MASTER ORDERS: Allow user to CREATE their record */
    "orders": {
      ".read": "auth != null && (auth.token.email === 'alenacloft0@gmail.com' || (query.orderByChild === 'uid' && query.equalTo === auth.uid))",
      ".indexOn": ["uid", "status"],
      "$orderid": {
        // Allow user to write only if the record is brand new and belongs to them
        ".write": "auth != null && (!data.exists() && newData.child('uid').val() === auth.uid) || auth.token.email === 'alenacloft0@gmail.com'"
      }
    },

    /* 6. USER HISTORY: Allow user to CREATE their record */
    "user_orders": {
      "$uid": {
        ".read": "auth != null && (auth.uid === $uid || auth.token.email === 'alenacloft0@gmail.com')",
        "$orderid": {
          // Allow user to write only if the record is brand new
          ".write": "auth != null && (auth.uid === $uid && !data.exists()) || auth.token.email === 'alenacloft0@gmail.com'"
        }
      }
    }
  }
}
