<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Manager â€” GiganticDataHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #6a5af9; --bg: #f4f7fe; --card: #ffffff; }
        [data-theme="dark"] { --bg: #020617; --card: #0f172a; }
        body { background: var(--bg); font-family: 'Inter', sans-serif; padding-bottom: 40px; }
        
        .admin-card { background: var(--card); border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05); }
        .input-field { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e2e8f0; background: transparent; outline: none; margin-bottom: 20px; font-size: 14px; }
        .input-field:focus { border-color: var(--primary); ring: 2px var(--primary); }
        
        .btn-publish { background: linear-gradient(135deg, #6a5af9 0%, #4f46e5 100%); color: white; padding: 16px; border-radius: 12px; width: 100%; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-publish:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(106, 90, 249, 0.3); }
        
        #editor { min-height: 400px; }
        .preview-img { width: 100%; h-48; object-fit: cover; border-radius: 12px; margin-bottom: 10px; display: none; background: #f1f5f9; }
        #authLoader { position: fixed; inset: 0; background: var(--bg); z-index: 999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="authLoader">
    <i class="fas fa-circle-notch fa-spin fa-2x text-indigo-500"></i>
</div>

<header class="bg-slate-900 text-white p-6 mb-8">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-3">
            <a href="dashboard.html"><i class="fas fa-chevron-left"></i></a>
            <h1 class="text-lg font-black uppercase tracking-tighter">Blog Console</h1>
        </div>
        <div class="bg-indigo-500 px-3 py-1 rounded-full text-[10px] font-black uppercase">Admin Terminal</div>
    </div>
</header>

<main class="max-w-4xl mx-auto px-4">
    <div class="admin-card p-8">
        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Create New Article</h2>
        
        <img id="imagePreview" class="preview-img" src="" alt="Preview">
        
        <label class="block text-xs font-bold uppercase mb-2">Cover Image URL</label>
        <input type="text" id="postImage" class="input-field" placeholder="Paste Unsplash or direct image link..." oninput="updatePreview()">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-xs font-bold uppercase mb-2">Article Title</label>
                <input type="text" id="postTitle" class="input-field" placeholder="e.g., How to save 50% on MTN Data">
            </div>
            <div>
                <label class="block text-xs font-bold uppercase mb-2">Category</label>
                <select id="postCategory" class="input-field">
                    <option value="Data Savings">Data Savings</option>
                    <option value="Digital Growth">Digital Growth</option>
                    <option value="Tech Tips">Tech Tips</option>
                    <option value="Business">Business</option>
                </select>
            </div>
        </div>

        <label class="block text-xs font-bold uppercase mb-2">Short Excerpt (AdSense Optimization)</label>
        <textarea id="postExcerpt" class="input-field h-20" placeholder="Brief 2-sentence summary..."></textarea>

        <label class="block text-xs font-bold uppercase mb-2">Article Content (HTML Supported)</label>
        <textarea id="postContent" class="input-field h-80 font-mono text-sm" placeholder="Write your 800-1200 word article here. Use <h2> for headings..."></textarea>

        <button onclick="publishBlog()" class="btn-publish">
            <i class="fas fa-paper-plane mr-2"></i> Publish Article
        </button>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBmu4xukuT0Z7oD_vA9QroeO-1ZuaK8JgA",
        authDomain: "gigantic-data.firebaseapp.com",
        databaseURL: "https://gigantic-data-default-rtdb.firebaseio.com",
        projectId: "gigantic-data"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const MASTER_EMAIL = "alenacloft0@gmail.com";

    onAuthStateChanged(auth, (user) => {
        if (user && user.email === MASTER_EMAIL) {
            document.getElementById('authLoader').style.display = 'none';
        } else {
            window.location.replace("login.html");
        }
    });

    window.updatePreview = () => {
        const url = document.getElementById('postImage').value;
        const img = document.getElementById('imagePreview');
        if(url) {
            img.src = url;
            img.style.display = 'block';
        } else {
            img.style.display = 'none';
        }
    }

    window.publishBlog = async () => {
        const title = document.getElementById('postTitle').value.trim();
        const image = document.getElementById('postImage').value.trim();
        const category = document.getElementById('postCategory').value;
        const excerpt = document.getElementById('postExcerpt').value.trim();
        const content = document.getElementById('postContent').value.trim();

        if(!title || !content) return alert("Title and Content are required!");

        try {
            const blogRef = ref(db, 'blog_posts');
            const newPostRef = push(blogRef);
            await set(newPostRef, {
                title,
                imageUrl: image || "https://images.unsplash.com/photo-1526628953301-3e589a6a8b74?q=80&w=1000",
                category,
                excerpt,
                content,
                timestamp: Date.now(),
                author: "Admin"
            });

            alert("Article Published Successfully!");
            // Reset form
            document.getElementById('postTitle').value = "";
            document.getElementById('postImage').value = "";
            document.getElementById('postExcerpt').value = "";
            document.getElementById('postContent').value = "";
            document.getElementById('imagePreview').style.display = 'none';
            
        } catch (e) {
            alert("Error publishing: " + e.message);
        }
    }
</script>
</body>
</html>
