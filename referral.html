{
  "rules": {
    /* 1. ADMIN SETTINGS */
    "admin_settings": {
      ".read": "auth.token.email === 'alenacloft0@gmail.com'",
      ".write": "auth.token.email === 'alenacloft0@gmail.com'"
    },

    /* 2. USERS: Intelligent Access & Hacker Protection */
    "users": {
      // Allow general read for Leaderboard (filtering done by Query in JS)
      ".read": "auth != null",
      // Indexing required for the Affiliate Leaderboard
      ".indexOn": ["referralCount", "uid"],
      
      "$uid": {
        ".read": "auth != null && (auth.uid === $uid || auth.token.email === 'alenacloft0@gmail.com')",
        
        // HACKER PROTECTION: No user can manually add balance, wallet, or referral stats.
        "balance": { ".write": "auth != null && auth.uid === $uid && newData.val() < data.val() && newData.val() >= 0" },
        "wallet": { ".write": "auth != null && auth.uid === $uid && newData.val() < data.val() && newData.val() >= 0" },
        "referralCount": { ".write": "false" },
        "referralBonus": { ".write": "false" },
        
        // Profile can only be created once during registration
        ".write": "auth != null && auth.uid === $uid && !data.exists()"
      }
    },

    /* 3. TRANSACTIONS & HISTORY */
    "transactions": {
      ".read": "auth != null && (auth.token.email === 'alenacloft0@gmail.com' || query.orderByChild === 'uid' && query.equalTo === auth.uid)",
      ".indexOn": ["uid"],
      "$txid": { ".write": "auth.token.email === 'alenacloft0@gmail.com'" }
    },

    /* 4. PENDING ORDERS: The Secure Trigger */
    "pending_orders": {
      ".read": "auth.token.email === 'alenacloft0@gmail.com'",
      "$orderid": {
        ".write": "auth != null && !data.exists() && newData.child('uid').val() === auth.uid",
        ".validate": "newData.hasChildren(['network', 'plan', 'recipient', 'amount', 'uid', 'status', 'timestamp'])"
      }
    },

    /* 5. MASTER ORDERS */
    "orders": {
      ".read": "auth != null && (auth.token.email === 'alenacloft0@gmail.com' || (query.orderByChild === 'uid' && query.equalTo === auth.uid))",
      ".indexOn": ["uid", "status"],
      "$orderid": { ".write": "auth.token.email === 'alenacloft0@gmail.com'" }
    },

    /* 6. USER HISTORY */
    "user_orders": {
      "$uid": {
        ".read": "auth != null && (auth.uid === $uid || auth.token.email === 'alenacloft0@gmail.com')",
        "$orderid": { ".write": "auth.token.email === 'alenacloft0@gmail.com'" }
      }
    }
  }
}
