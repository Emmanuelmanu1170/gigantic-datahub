<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Gigantic Data Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
body { background:#f0f4f9; color:#0a2a66; min-height:100vh; }

header { 
    background:#0a2a66; 
    color:#fff; 
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    padding:15px 5%; 
    position:fixed; 
    width:100%; 
    top:0; 
    z-index:100; 
    box-shadow:0 4px 12px rgba(0,0,0,0.15); 
}
header h1 { font-size:1.2rem; font-weight:700; letter-spacing:0.5px; }

.nav-buttons { display:flex; gap:8px; margin-top:10px; flex-wrap: wrap; align-items: center; }
.nav-buttons button, .nav-buttons a.nav-link-btn { 
    padding:8px 14px; 
    border:none; 
    border-radius:6px; 
    background:#1e90ff; 
    color:#fff; 
    font-weight:600; 
    font-size: 13px;
    cursor:pointer; 
    transition:0.2s; 
    display: flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
}
.nav-buttons button:hover, .nav-buttons a.nav-link-btn:hover { background:#0d6efd; transform: translateY(-1px); }

/* Custom Colors for New Buttons */
.btn-system { background: #ef4444 !important; } /* Red */
.btn-agent { background: #f59e0b !important; }  /* Amber */

.container { padding: 180px 5% 40px; max-width:1300px; margin:auto; }

.summary-boxes { display:flex; flex-wrap:wrap; gap:15px; margin-bottom:25px; }
.summary-box { 
    background:#fff; 
    padding:20px; 
    border-radius:12px; 
    box-shadow:0 4px 15px rgba(0,0,0,0.05); 
    flex:1; 
    min-width:180px; 
    border-bottom: 4px solid #1e90ff;
}
.summary-box h3 { margin-bottom:8px; font-size:0.85rem; color:#64748b; text-transform: uppercase; letter-spacing: 1px; }
.summary-box p { font-size:1.5rem; font-weight:700; color: #0a2a66; }

.status-box { background:#fff; padding:12px 20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-bottom:20px; display:flex; justify-content:space-between; font-size: 14px; }

.card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.05); margin-bottom:20px; }
.card h3 { margin-bottom:15px; font-size: 1.1rem; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }

.admin-nav-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    background: #0f172a;
    color: white;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 700;
    font-size: 13px;
    border: 1px solid #3b82f6;
    transition: 0.3s;
}
.admin-nav-btn:hover { background: #1e293b; transform: scale(1.02); }

.btn-danger { background:#ff4d4f; color:#fff; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight: 600; }
.footer { background:#0a2a66; color:#fff; text-align:center; padding:20px; margin-top:30px; }
.toast { position:fixed; right:20px; bottom:20px; background:#0a2a66; color:#fff; padding:12px 20px; border-radius:8px; display:none; z-index:9999; }
</style>
</head>
<body>

<header>
  <div>
    <h1>Gigantic Data Hub — Admin</h1>
    <div class="nav-buttons">
      <button onclick="location.href='admin_dashboard.html'"><i class="fas fa-chart-line"></i> Dashboard</button>
      
      <button class="btn-system" onclick="location.href='admin.html'"><i class="fas fa-cogs"></i> Admin System</button>
      <button class="btn-agent" onclick="location.href='agent.html'"><i class="fas fa-user-tie"></i> Agent Panel</button>
      
      <button onclick="window.location.href='topup.html'"><i class="fas fa-plus-circle"></i> Top-Up</button>
      <button onclick="location.href='users.html'"><i class="fas fa-users"></i> Users</button>
      <button onclick="location.href='orders.html'"><i class="fas fa-shopping-cart"></i> Orders</button>
      <button onclick="location.href='wallet.html'"><i class="fas fa-wallet"></i> Wallet</button>
      
      <a href="admin_credit.html" class="admin-nav-btn" id="adminLink" style="display: none;">
          <i class="fas fa-user-shield" style="color: #ff8c00;"></i>
          <span>Admin Credit Panel</span>
      </a>
    </div>
  </div>
  <button id="logoutBtn" class="btn-danger">Logout</button>
</header>

<div class="container">
  <div class="status-box">
    <span>Admin: <strong id="adminEmail" style="color:#1e90ff">Loading...</strong></span>
    <span>System Status: <strong id="adminStatus" style="color:#28c76f">Online</strong></span>
  </div>

  <div class="summary-boxes">
    <div class="summary-box">
      <h3>Total Users</h3>
      <p id="totalUsers">0</p>
    </div>
    <div class="summary-box">
      <h3>Total Orders</h3>
      <p id="totalOrders">0</p>
    </div>
    <div class="summary-box">
      <h3>Total Sales (₵)</h3>
      <p id="totalSales">0.00</p>
    </div>
    <div class="summary-box" style="background: #fff9f0; border-bottom-color: #ff8c00;">
        <h3>Today Sales (5%)</h3>
        <p id="todaySales" style="color: #ff8c00;">0.00</p>
    </div>
    <div class="summary-box">
      <h3>System Wallet (₵)</h3>
      <p id="totalWallet">0.00</p>
    </div>
  </div>

  <div style="display: flex; flex-wrap: wrap; gap: 20px;">
    <div style="flex: 1; min-width: 300px;">
        <div class="card">
            <h3><i class="fas fa-clock" style="color:#ff8c00"></i> Pending Credits</h3>
            <div id="referralList" style="max-height: 400px; overflow-y: auto;">Loading...</div>
        </div>
    </div>

    <div style="flex: 1; min-width: 300px;">
        <div class="card">
            <h3><i class="fas fa-tools"></i> Management Tools</h3>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <a href="admin_withdraw.html" class="admin-nav-btn" style="background: #475569;">
                    <i class="fas fa-money-bill-transfer"></i> Manage Withdrawals
                </a>
                <a href="admin-password.html" class="admin-nav-btn" style="background: #003366;">
                    <i class="fas fa-lock-open"></i> Manage User Passwords
                </a>
                <a href="admin-ads.html" class="admin-nav-btn" style="background: #1e293b;">
                    <i class="fas fa-ad"></i> Manage Dashboard Ads
                </a>
            </div>
        </div>
    </div>
  </div>
</div>

<div class="footer">© 2026 Gigantic Data Hub. Admin Control Panel</div>
<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// UNIFIED CONFIG: Matches your working Admin engine
const firebaseConfig = {
    apiKey: "AIzaSyBmu4xukuT0Z7oD_vA9QroeO-1ZuaK8JgA",
    authDomain: "gigantic-data.firebaseapp.com",
    databaseURL: "https://gigantic-data-default-rtdb.firebaseio.com",
    projectId: "gigantic-data"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const ADMIN_EMAIL = "alenacloft0@gmail.com";

// SECURE SESSION OBSERVER
onAuthStateChanged(auth, async user => {
  // Checks if user exists AND if email matches yours
  if(!user || user.email.toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
    console.log("Redirecting to login...");
    location.href="admin_login.html";
    return;
  }
  
  document.getElementById("adminLink").style.display = "flex";
  document.getElementById("adminEmail").textContent = user.email;
  
  initDashboard();
});

function initDashboard() {
    loadSummary();
}

async function loadSummary() {
    onValue(ref(db, "orders"), async (snap) => {
        const orders = snap.exists() ? Object.values(snap.val()) : [];
        const usersSnap = await get(ref(db, "users"));
        const users = usersSnap.exists() ? usersSnap.val() : {};
        
        document.getElementById("totalUsers").textContent = Object.keys(users).length;
        document.getElementById("totalOrders").textContent = orders.length;
        
        const successOrders = orders.filter(o => ["completed","success","successful"].includes(String(o.status).toLowerCase()));
        const totalSales = successOrders.reduce((sum, o) => sum + Number(o.amount || o.price || 0), 0);
        document.getElementById("totalSales").textContent = totalSales.toFixed(2);
        document.getElementById("todaySales").textContent = (totalSales * 0.05).toFixed(2);
        
        const totalWallet = Object.values(users).reduce((sum, u) => sum + Number(u.balance || u.wallet || 0), 0);
        document.getElementById("totalWallet").textContent = totalWallet.toFixed(2);
    });
}

document.getElementById("logoutBtn").onclick = () => {
    signOut(auth).then(() => location.href="admin_login.html");
};
</script>

<br>
<a href="hackers.html" class="btn-security">
    <i class="fas fa-user-shield"></i>
    <span>Financial Guard</span>
</a>

<style>
    .btn-security {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%);
        color: white;
        text-decoration: none;
        border-radius: 12px;
        font-weight: 800;
        font-size: 14px;
        transition: 0.3s;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        margin: 20px 5%;
    }
    .btn-security:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        filter: brightness(1.1);
    }
</style>

</body>
</html>
